<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fly Rider — العب واكسب توصيلة مجانية</title>
<style>
  :root{
    --bg1:#eaf6ff; --bg2:#ffffff;
    --ui:#0e2a3d; --muted:#50748a; --pill:#fff;
    --accent:#2ecc71; --shadow:0 10px 30px rgba(0,0,0,.08);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:system-ui, -apple-system, "Segoe UI", Cairo, Roboto, sans-serif;background:linear-gradient(var(--bg1),var(--bg2));color:var(--ui)}
  .wrap{max-width:980px;margin:0 auto;padding:14px}
  h1{display:flex;gap:10px;align-items:center;justify-content:space-between;margin:6px 0 10px;font-size:28px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .pill{background:var(--pill);border:1px solid #e5eef6;border-radius:16px;padding:10px 14px;box-shadow:var(--shadow);font-weight:800;color:var(--ui)}
  .btn{cursor:pointer;border:none;border-radius:999px;padding:10px 16px;background:#20c997;color:#fff;font-weight:900;box-shadow:0 12px 24px rgba(32,201,151,.35)}
  .btn:active{transform:translateY(1px)}
  .board{position:relative}
  #game{display:block;width:100%;max-width:980px;height:320px;border-radius:16px;border:1px solid #dfe8f0;background:transparent;box-shadow:var(--shadow)}
  .overlay{position:absolute;inset:0;display:grid;place-items:center;text-align:center;background:rgba(255,255,255,.55);backdrop-filter:blur(3px);border-radius:16px;border:1px dashed #cfe0ed;font-weight:900}
  .overlay.hidden{display:none}
  .toast{position:fixed;inset:auto 12px 12px 12px;margin:auto;max-width:520px;background:#fff;border:1px solid #e6eef5;border-radius:16px;padding:14px 16px;box-shadow:0 18px 40px rgba(0,0,0,.12);display:none;text-align:center}
  .toast.show{display:block;animation:pop .35s ease}
  @keyframes pop{from{transform:translateY(12px);opacity:0}to{transform:translateY(0);opacity:1}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="row">
      <button id="btnStart" class="btn">ابدأ</button>
      <button id="btnSound" class="pill">تشغيل الصوت 🔊</button>
    </div>

    <h1>Fly Rider 🏍️</h1>

    <div class="row" style="margin-bottom:10px">
      <div class="pill">أعلى نتيجة: <span id="best">0</span></div>
      <div class="pill">المسافة: <span id="score">0</span> / 10000</div>
    </div>

    <div class="board">
      <canvas id="game" width="980" height="320" aria-label="Fly Rider Game"></canvas>
      <div id="overlay" class="overlay">
        <div>
          اضغط <span style="color:#2ecc71">ابدأ</span> أو المس الشاشة للانطلاق<br/>
          الهدف: 10000 نقطة — اقفز وتفادَ العوائق ✨
        </div>
      </div>
    </div>

    <p style="color:var(--muted);font-weight:700">لو خبطت في عائق — اضغط الشاشة لإعادة المحاولة ✨</p>
  </div>

  <div id="toast" class="toast"></div>

<script>
/* ====== إعدادات عامة ====== */
const RIDER_SRC = 'https://i.ibb.co/0pCGtrP6/Picsart-25-10-16-11-05-31-905.png'; // صورتك
const GOAL = 10000;

const canvas = document.getElementById('game');
const c = canvas.getContext('2d');
const dpi = window.devicePixelRatio || 1;
function fixDPI(){
  const cssW = canvas.clientWidth, cssH = canvas.clientHeight;
  canvas.width = Math.round(cssW * dpi);
  canvas.height = Math.round(cssH * dpi);
  c.setTransform(dpi,0,0,dpi,0,0);
}
fixDPI(); addEventListener('resize', fixDPI);

const W = ()=>canvas.clientWidth;
const H = ()=>canvas.clientHeight;
const GROUND_Y = ()=> H()*0.82;

let running=false, gameOver=false, won=false;
let score=0, best=parseInt(localStorage.getItem('flyrider_best')||'0',10);
document.getElementById('best').textContent = best;
let speed = 6;

/* ====== تحميل الصورة بأمان + بديل ====== */
const riderImg = new Image();
riderImg.crossOrigin='anonymous';
let imageReady=false, usePlaceholder=false;
riderImg.onload = ()=>{ imageReady=true; drawStatic(); };
riderImg.onerror = ()=>{ usePlaceholder=true; drawStatic(); };
riderImg.src = RIDER_SRC;

const rider = { x:80, y:0, w:190, h:120, vy:0, onGround:true, wheelAngle:0 };
const wheelRelative = {
  back:{x:0.28,y:0.83,r:0.12},
  front:{x:0.74,y:0.85,r:0.12}
};

/* ====== عوائق ====== */
const obstacles = [];
function spawnObstacle(){
  const gap = 140 + Math.random()*120;
  const last = obstacles[obstacles.length-1];
  const x = last ? last.x + gap + 40 + Math.random()*80 : W() + 60;
  const h = 30 + Math.random()*35;
  const w = 26 + Math.random()*32;
  obstacles.push({x, y: GROUND_Y()-h, w, h});
}
for(let i=0;i<5;i++) spawnObstacle();

/* ====== صوت بسيط ====== */
let AC, ctx, gain; let soundOn=false;
function audioInit(){ if(ctx) return; const A=window.AudioContext||window.webkitAudioContext; if(!A) return; ctx=new A(); gain=ctx.createGain(); gain.gain.value=0.18; gain.connect(ctx.destination); }
function beep(freq=880, dur=.08, type='square'){
  if(!ctx||!soundOn) return;
  const o=ctx.createOscillator(), g=ctx.createGain();
  o.type=type; o.frequency.value=freq; o.connect(g); g.connect(gain);
  g.gain.setValueAtTime(0.0001, ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(.6, ctx.currentTime+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+dur);
  o.start(); o.stop(ctx.currentTime+dur+0.01);
}
const btnSound=document.getElementById('btnSound');
btnSound.onclick=()=>{ audioInit(); soundOn=!soundOn; if(gain) gain.gain.value=soundOn?0.18:0.0; btnSound.textContent=soundOn?'إيقاف الصوت 🔇':'تشغيل الصوت 🔊'; };

/* ====== تحكم ====== */
const overlay=document.getElementById('overlay');
function startGame(){ if(running) return; overlay.classList.add('hidden'); running=true; gameOver=false; won=false; lastTime=performance.now(); requestAnimationFrame(loop); }
function jump(){ if(!running) startGame(); if(!rider.onGround||gameOver) return; rider.vy=-13; rider.onGround=false; beep(920,.07,'square'); }
document.getElementById('btnStart').onclick=jump;
canvas.addEventListener('pointerdown', jump);
addEventListener('keydown', e=>{
  if([' ','ArrowUp','w','W'].includes(e.key)){ e.preventDefault(); jump(); }
  if((e.key==='r'||e.key==='R') && gameOver) resetGame();
});
['click','touchstart','pointerdown'].forEach(ev=>addEventListener(ev,audioInit,{once:true}));

/* ====== رسم الخلفية والطريق ====== */
function drawBackground(){
  const y=GROUND_Y(), h=H()-y;
  const grd=c.createLinearGradient(0,y,0,H());
  grd.addColorStop(0,'#cfe3d1'); grd.addColorStop(1,'#b3d3b9');
  c.fillStyle=grd; c.fillRect(0,y-4,W(),h+4);
  c.strokeStyle='#c6d0db'; c.lineWidth=2; c.beginPath(); c.moveTo(0,y); c.lineTo(W(),y); c.stroke();
  c.fillStyle='#ffffff';
  const segW=40,gap=70,offset=-(Date.now()/20 % (segW+gap));
  for(let x=offset;x<W();x+=segW+gap){ c.fillRect(x,y-6,segW,3); }
}

/* ====== رسم اللاعب + دوران العجل ====== */
function drawRider(){
  c.fillStyle='rgba(0,0,0,.12)'; c.beginPath(); c.ellipse(rider.x + rider.w*0.55, GROUND_Y()+6, 48, 10, 0,0,Math.PI*2); c.fill();

  if(imageReady && !usePlaceholder){
    c.drawImage(riderImg, rider.x, rider.y, rider.w, rider.h);
  }else{
    // بديل بسيط لو الصورة فشلت
    const y=rider.y,w=rider.w,h=rider.h;
    c.fillStyle='#2b9e91'; c.fillRect(rider.x+w*0.35, y+h*0.45, w*0.25, h*0.2);
    c.fillStyle='#172d3b';
    const r=w*0.12;
    c.beginPath(); c.arc(rider.x+w*0.28, y+h*0.83, r, 0, Math.PI*2); c.fill();
    c.beginPath(); c.arc(rider.x+w*0.74, y+h*0.85, r, 0, Math.PI*2); c.fill();
  }
  // دوران العجل
  rider.wheelAngle -= speed*0.12;
  [['back',wheelRelative.back],['front',wheelRelative.front]].forEach(([_,rel])=>{
    const cx=rider.x+rider.w*rel.x, cy=rider.y+rider.h*rel.y, r=rider.w*rel.r;
    c.save(); c.translate(cx,cy); c.rotate(rider.wheelAngle);
    c.strokeStyle='#e6f2ff'; c.lineWidth=2;
    for(let i=0;i<4;i++){ c.rotate(Math.PI/2); c.beginPath(); c.moveTo(0,0); c.lineTo(r-5,0); c.stroke(); }
    c.restore();
  });
}

/* ====== عوائق ====== */
function drawObstacles(){
  c.fillStyle='#2c3e50';
  obstacles.forEach(o=>{ o.x -= speed; c.fillRect(o.x,o.y,o.w,o.h); });
  while(obstacles.length && obstacles[0].x + obstacles[0].w < -20){ obstacles.shift(); spawnObstacle(); }
}

/* ====== فيزياء وتصادم ====== */
function physics(){
  rider.vy += 0.7; rider.y += rider.vy;
  if(rider.y + rider.h >= GROUND_Y()){ rider.y = GROUND_Y()-rider.h; rider.vy=0; rider.onGround=true; }
  const rx=rider.x+24, ry=rider.y+12, rw=rider.w-38, rh=rider.h-18;
  for(const o of obstacles){
    if(rx < o.x+o.w && rx+rw > o.x && ry < o.y+o.h && ry+rh > o.y){ endGame(false); break; }
  }
}

/* ====== حلقة اللعبة ====== */
let lastTime=0;
function loop(ts){
  if(!running) return;
  const dt=(ts-lastTime)/16.67; lastTime=ts;
  c.clearRect(0,0,W(),H());
  drawBackground(); drawObstacles(); physics(); drawRider();
  score += Math.max(1, Math.floor(dt));
  if(score % 120 === 0) speed = Math.min(12, speed + 0.05);
  document.getElementById('score').textContent = score;
  if(score >= GOAL && !won){ endGame(true); return; }
  requestAnimationFrame(loop);
}

/* ====== رسائل/إعادة ====== */
const toast=document.getElementById('toast');
function showToast(msg){ toast.textContent=msg; toast.classList.add('show'); }
function endGame(isWin){
  running=false; gameOver=true; won=isWin;
  best=Math.max(best,score); localStorage.setItem('flyrider_best',best);
  document.getElementById('best').textContent=best;
  if(isWin){
    showToast('🎉 مبروك! كسبت توصيلة مجانية — خُد لقطة شاشة وابعتها على واتساب ✅');
    beep(660,.12,'sine'); setTimeout(()=>beep(990,.16,'sine'),120);
    // لتمكين التحويل للواتساب تلقائيًا بعد الفوز، فك التعليق:
    // location.href='https://wa.me/201017908076?text='+encodeURIComponent('أنا كسبت توصيلة مجانية! وصلت 10000 في لعبة Fly Rider 🎉');
  }else{
    showToast('💥 أوووبس! حاول تاني — اضغط الشاشة لإعادة المحاولة');
    beep(180,.16,'sawtooth');
  }
  setTimeout(()=>overlay.classList.remove('hidden'),200);
}
function resetGame(){
  score=0; speed=6;
  rider.y=GROUND_Y()-rider.h; rider.vy=0; rider.onGround=true; rider.wheelAngle=0;
  obstacles.length=0; for(let i=0;i<5;i++) spawnObstacle();
  overlay.classList.add('hidden'); toast.classList.remove('show');
  running=true; gameOver=false; won=false; lastTime=performance.now();
  requestAnimationFrame(loop);
}
overlay.addEventListener('pointerdown', ()=> gameOver ? resetGame() : startGame());

/* ====== رسم ثابت عند الفتح ====== */
function drawStatic(){
  c.clearRect(0,0,W(),H());
  drawBackground();
  rider.y = GROUND_Y() - rider.h;
  drawRider();
}
drawStatic();
</script>
</body>
</html>
