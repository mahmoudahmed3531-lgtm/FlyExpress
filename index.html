<script>
(function () {
  const SOUND_URL = 'https://h.uguu.se/kwmAtLDd.mp3';   // رابط الصوت
  const MIN_WAIT = 1200;   // زمن الانتظار قبل الانتقال (ms)

  // عنصر صوت واحد مُعاد استخدامه
  const audio = new Audio(SOUND_URL);
  audio.preload = 'auto';

  // ألغِ أي مستمعات قديمة (لو اتكررت)
  document.querySelectorAll('a.btn[href]').forEach(a => {
    const clone = a.cloneNode(true);
    clone.removeAttribute('target');        // إجبار نفس التبويب
    a.replaceWith(clone);
  });

  function handleClick(e) {
    e.preventDefault();
    const href = this.href;

    // شغّل الصوت
    audio.currentTime = 0;
    audio.play().catch(()=>{ /* لو اتمنع الصوت هنمشي على التايمر */ });

    // مانع نقرات متكررة مؤقتًا
    document.body.style.pointerEvents = 'none';
    document.body.style.cursor = 'wait';

    let moved = false;
    const go = () => {
      if (moved) return;
      moved = true;
      document.body.style.pointerEvents = '';
      document.body.style.cursor = '';
      window.location.assign(href);  // نفس التبويب — ولا تبويبات جانبية
    };

    // انقل بعد MIN_WAIT كحد أقصى
    const t = setTimeout(go, MIN_WAIT);

    // لو الصوت خلص قبل MIN_WAIT انقل مباشرة
    audio.onended = () => { clearTimeout(t); go(); };
  }

  // اربط المستمع بعد التنظيف
  document.querySelectorAll('a.btn[href]').forEach(a => {
    a.addEventListener('click', handleClick, { passive: false });
  });
})();
</script>
