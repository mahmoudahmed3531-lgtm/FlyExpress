<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fly Rider â€” Ø§Ù„Ø¹Ø¨ ÙˆØ§ÙƒØ³Ø¨ ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ©</title>
<style>
  :root{
    --ink:#0c2b3a; --muted:#5d7b8a; --panel:#ffffff;
    --brand:#16a34a; --danger:#ef4444; --sky1:#eaf6ff; --sky2:#ffffff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,"Segoe UI","Cairo",Roboto,sans-serif; color:var(--ink);
    background:linear-gradient(180deg,var(--sky1),var(--sky2) 55%);
  }
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  header{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  h1{margin:0;font-size:32px;font-weight:900;display:flex;gap:10px;align-items:center}
  .statbar{display:flex;gap:10px;flex-wrap:wrap}
  .badge{background:var(--panel);border:1px solid #e6eef5;border-radius:14px;padding:10px 14px;font-weight:800;box-shadow:0 6px 16px rgba(0,0,0,.05)}
  .btn{border:none;border-radius:999px;padding:12px 18px;font-weight:900;cursor:pointer}
  .btn.green{background:var(--brand);color:#fff}
  .btn.gray{background:#eef2f7;color:#1f2937}
  .btn:active{transform:translateY(1px)}
  .frame{position:relative;margin-top:12px;border-radius:16px;background:#f7fbff;border:1px solid #e6eef5;box-shadow:0 10px 26px rgba(0,0,0,.06)}
  canvas{display:block;width:100%;height:340px;border-radius:16px}
  .hint{text-align:center;color:var(--muted);font-weight:800;margin:8px 0 0}
  .overlay{
    position:absolute;inset:0;display:grid;place-items:center;text-align:center;background:rgba(255,255,255,.6);
    border-radius:16px;border:1px dashed #cfe0ed;backdrop-filter:blur(3px)
  }
  .overlay.hidden{display:none}
  .overlay .box{background:#fff;border:1px solid #e6eef5;border-radius:14px;padding:14px 16px;box-shadow:0 8px 20px rgba(0,0,0,.08)}
  .toast{
    position:fixed;inset:auto 12px 12px 12px;margin:auto;max-width:540px;
    background:#fff;border:1px solid #e6eef5;border-radius:14px;padding:14px 16px;
    box-shadow:0 18px 40px rgba(0,0,0,.12);display:none;text-align:center;font-weight:900
  }
  .toast.show{display:block;animation:pop .35s ease}
  @keyframes pop{from{transform:translateY(12px);opacity:0}to{transform:translateY(0);opacity:1}}

  /* Ø³Ø­Ø¨ Ø¨Ø³ÙŠØ·Ø© */
  .cloud{position:absolute;top:12%;width:180px;height:60px;background:#fff;border-radius:40px;filter:blur(.2px);opacity:.9}
  .cloud:before,.cloud:after{content:"";position:absolute;background:#fff;border-radius:50%}
  .cloud:before{width:80px;height:80px;left:20px;top:-30px}
  .cloud:after{width:60px;height:60px;left:100px;top:-18px}
  .c1{left:110%;animation:cloud 28s linear infinite}
  .c2{left:140%;top:20%;transform:scale(.9);animation:cloud 34s linear infinite}
  .c3{left:170%;top:26%;transform:scale(1.05);animation:cloud 42s linear infinite}
  @keyframes cloud{to{transform:translateX(-260%)}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Fly Rider ğŸï¸</h1>
      <div class="statbar">
        <div class="badge">Ø§Ù„Ù…Ø³Ø§ÙØ©: <span id="score">0</span> / 10000</div>
        <div class="badge">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: <span id="best">0</span></div>
        <button id="btnSound" class="btn gray">ğŸ”ˆ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª</button>
        <button id="btnStart" class="btn green">Ø§Ø¨Ø¯Ø£</button>
      </div>
    </header>

    <div class="frame">
      <div class="cloud c1"></div><div class="cloud c2"></div><div class="cloud c3"></div>
      <canvas id="game" width="960" height="340" aria-label="Fly Rider Game"></canvas>

      <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª/Ø§Ù„Ø¨Ø¯Ø¡ -->
      <div id="overlay" class="overlay">
        <div class="box">
          <div style="font-size:18px;margin-bottom:4px">Ø§Ø¶ØºØ· <b>Ø§Ø¨Ø¯Ø£</b> Ø£Ùˆ Ø§Ù„Ù…Ø³ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚</div>
          <div style="color:#0b5d2d;font-weight:900">Ø§Ù„Ù‡Ø¯Ù: 10000 Ù†Ù‚Ø·Ø© â€” Ø§Ù‚ÙØ² ÙˆØªÙØ§Ø¯Ù‰ Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚ âœ¨</div>
          <div style="font-size:12px;color:#6b7280;margin-top:6px">ØªÙ„Ù…ÙŠØ­: Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡ ÙŠÙˆØ¬Ø¯ <b>Ù…Ù‡Ù„Ø© Ø£Ù…Ø§Ù† 1.2 Ø«Ø§Ù†ÙŠØ©</b> Ù‚Ø¨Ù„ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù…</div>
        </div>
      </div>
    </div>

    <p class="hint">Ù„Ùˆ Ø®Ø¨Ø·Øª ÙÙŠ Ø¹Ø§Ø¦Ù‚ â€” Ø§Ø¶ØºØ· Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© âœ¨</p>
  </div>

  <div id="toast" class="toast"></div>

  <!-- ØµÙˆØª Ø§Ù„Ø®Ù„ÙÙŠØ© (ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© ÙÙ‚Ø·) -->
  <audio id="bgm" src="https://files.catbox.moe/xx1c3u.mp3" loop preload="auto" playsinline></audio>

<script>
/* ==================== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù†ÙØ³ ==================== */
const canvas = document.getElementById('game');
const c = canvas.getContext('2d');
const dpi = window.devicePixelRatio || 1;
function fixDPI(){
  const cssW = canvas.clientWidth, cssH = canvas.clientHeight;
  canvas.width = Math.round(cssW * dpi);
  canvas.height = Math.round(cssH * dpi);
  c.setTransform(dpi,0,0,dpi,0,0);
}
fixDPI(); addEventListener('resize', fixDPI);
const W = () => canvas.clientWidth, H = () => canvas.clientHeight;
const GROUND_Y = () => Math.round(H() * 0.78);

/* ==================== Ø§Ù„ØµÙˆØª ==================== */
const bgm = document.getElementById('bgm');
let soundOn = false;
const btnSound = document.getElementById('btnSound');

// Ù„Ø§ ØªÙØ¸Ù‡Ø± Ø¥Ø´Ø¹Ø§Ø± Media Session
if ('mediaSession' in navigator) navigator.mediaSession.metadata = null;

// ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù
btnSound.addEventListener('click', async ()=>{
  try{
    if(!soundOn){ await bgm.play(); soundOn=true; btnSound.textContent='ğŸ”‡ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª'; }
    else { bgm.pause(); soundOn=false; btnSound.textContent='ğŸ”ˆ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª'; }
  }catch(e){ console.log(e); }
});
// Ø£ÙˆÙ‚Ù Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ØŒ Ø´ØºÙ‘Ù„Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ùˆ ÙƒØ§Ù† Ù…ÙÙØ¹Ù‘Ù„
window.addEventListener('blur', ()=> bgm.pause());
window.addEventListener('focus', ()=> { if(soundOn) bgm.play(); });

/* ==================== Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ==================== */
let running=false, gameOver=false, won=false;
let score=0, best=parseInt(localStorage.getItem('flyrider_best')||'0',10);
document.getElementById('best').textContent = best;

// Ù…Ù‡Ù„Ø© Ø£Ù…Ø§Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡ Ù„Ù…Ù†Ø¹ Ø§Ù„Ù…ÙˆØª ÙÙˆØ±Ù‹Ø§
const SAFE_MS = 1200;
let safeUntil = 0;

// Ø§Ù„Ø³Ø±Ø¹Ø©
let speedBase = 6, speed = speedBase;

// Ø§Ù„Ù„Ø§Ø¹Ø¨ (ØµÙˆØ±Ø© Ø§Ù„Ù…ØªÙˆØ³ÙŠÙƒÙ„)
const RIDER_SRC = "https://i.ibb.co/1tr7xqfR/Picsart-25-10-16-13-30-56-445.png";
const riderImg = new Image();
riderImg.src = RIDER_SRC;

const rider = { x: 80, y: 0, w: 86, h: 60, vy: 0, onGround: true, wheelPhase: 0 };

// Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚
const obstacles = [];
function spawnObstacle(initial=false){
  const baseGap = 160 + Math.random()*140; // Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ†ÙŠØ©
  let x;
  if(initial){
    // Ø£ÙˆÙ„ Ø¹Ø§Ø¦Ù‚ Ø¨Ø¹ÙŠØ¯ Ø¬Ø¯Ù‹Ø§ Ø­ØªÙ‰ Ù„Ùˆ Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙÙˆØ±Ù‹Ø§
    x = W() + 260; // Ø¨Ø¹ÙŠØ¯ Ø¹Ù† Ø§Ù„Ø´Ø§Ø´Ø©
  }else{
    const last = obstacles[obstacles.length-1];
    x = (last ? last.x : W()+60) + baseGap + 40 + Math.random()*80;
  }
  const h = 26 + Math.random()*36;
  const w = 24 + Math.random()*28;
  obstacles.push({ x, y: GROUND_Y()-h, w, h });
}

/* Ø£Ø±Ø¶ÙŠØ© */
const roadMarks = Array.from({length:24},(_,i)=>({x:i*60+Math.random()*40}));

/* ==================== ÙˆØ§Ø¬Ù‡Ø© ÙˆØ²Ø± Ø§Ù„Ø¨Ø¯Ø¡ ==================== */
const overlay = document.getElementById('overlay');
const btnStart = document.getElementById('btnStart');
const toast = document.getElementById('toast');

btnStart.addEventListener('click', startOrJump);
canvas.addEventListener('pointerdown', startOrJump);
addEventListener('keydown', e=>{
  if([' ','ArrowUp','w','W'].includes(e.key)){ e.preventDefault(); startOrJump(); }
});

function startOrJump(){
  if(!running){ startGame(); return; }
  // Ù‚ÙØ²
  if(rider.onGround && !gameOver){
    rider.vy = -13; rider.onGround = false;
  }
}

/* ==================== Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± ==================== */
function drawBackground(){
  // Ø®Ø· Ø§Ù„Ø£Ø±Ø¶
  const y = GROUND_Y();
  c.strokeStyle = '#cbd5e1'; c.lineWidth=2;
  c.beginPath(); c.moveTo(0,y); c.lineTo(W(),y); c.stroke();

  // Ø´Ø±Ø§Ø¦Ø· Ø§Ù„Ø·Ø±ÙŠÙ‚
  c.fillStyle='#ffffff';
  const seg=40, gap=80, off= - (Date.now()/20 % (seg+gap));
  for(let x=off; x<W(); x+=seg+gap) c.fillRect(x,y-6,seg,3);

  // Ù…Ø±Ø¨Ø¹Ø§Øª/Ø¹Ù„Ø§Ù…Ø§Øª Ø®Ù„ÙÙŠØ© ØªØªØ­Ø±Ùƒ Ø¨Ø¨Ø·Ø¡ (Ø¨Ø§Ø±Ø§Ù„Ø§ÙƒØ³ Ø¨Ø³ÙŠØ·)
  c.globalAlpha = .08;
  const oy = y-40;
  const pOff = (Date.now()/35) % (W()+120);
  [10, 120, 240, 360, 520].forEach((d,i)=>{
    const w=60+ i*12, h=10+ i*2;
    c.fillStyle = '#94a3b8';
    c.fillRect(W()-pOff + d, oy - (i*20), w, h);
  });
  c.globalAlpha = 1;

  // Ø­ØµÙ‰ Ø§Ù„Ø·Ø±ÙŠÙ‚
  c.fillStyle='#a7b4c1';
  roadMarks.forEach(m=>{
    m.x -= speed*0.35; if(m.x<-12) m.x = W()+Math.random()*60;
    c.fillRect(m.x, y+8+Math.sin(m.x*0.05)*2, 6, 2);
  });
}

function drawRider(){
  const y = rider.y;

  // Ø¸Ù„
  c.fillStyle='rgba(0,0,0,.12)';
  c.beginPath();
  c.ellipse(rider.x + rider.w*0.5, GROUND_Y()+6, 36, 8, 0, 0, Math.PI*2);
  c.fill();

  // "Ù„Ù" Ø§Ù„Ø¹Ø¬Ù„ ÙƒØ£Ù†Ù‡Ø§ ØªØªØ­Ø±Ùƒ (Ø§Ù‡ØªØ²Ø§Ø² Ø¨Ø³ÙŠØ·)
  rider.wheelPhase += speed*0.08;
  const angle = Math.sin(rider.wheelPhase)*0.06;
  c.save();
  c.translate(rider.x+rider.w/2, y+rider.h/2);
  c.rotate(angle);
  c.drawImage(riderImg, -rider.w/2, -rider.h/2, rider.w, rider.h);
  c.restore();
}

function drawObstacles(){
  c.fillStyle='#1f2937';
  obstacles.forEach(o=>{ o.x -= speed; c.fillRect(o.x,o.y,o.w,o.h); });

  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚ Ø§Ù„ØªÙŠ Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© ÙˆØ¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯
  while(obstacles.length && obstacles[0].x + obstacles[0].w < -20){
    obstacles.shift(); spawnObstacle(false);
  }
}

/* ==================== ÙÙŠØ²ÙŠØ§Ø¡ + ØªØµØ§Ø¯Ù… ==================== */
function physics(){
  // Ø¬Ø§Ø°Ø¨ÙŠØ©
  rider.vy += 0.7;
  rider.y += rider.vy;
  if(rider.y + rider.h >= GROUND_Y()){
    rider.y = GROUND_Y() - rider.h;
    rider.vy = 0; rider.onGround = true;
  }

  // ØªØµØ§Ø¯Ù… (Ù…Ø¹ Ù…Ù‡Ù„Ø© Ø§Ù„Ø£Ù…Ø§Ù†)
  if(performance.now() > safeUntil){
    const rx = rider.x+12, ry = rider.y+6, rw = rider.w-24, rh = rider.h-12;
    for(const o of obstacles){
      if (rx < o.x + o.w && rx + rw > o.x && ry < o.y + o.h && ry + rh > o.y){
        endGame(false); break;
      }
    }
  }
}

/* ==================== Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ==================== */
let last=0;
function loop(ts){
  if(!running) return;
  const dt = (ts-last)/16.67; last = ts;

  c.clearRect(0,0,W(),H());
  drawBackground();
  drawObstacles();
  physics();
  drawRider();

  // Ù†Ù‚Ø§Ø· + Ø²ÙŠØ§Ø¯Ø© Ø³Ø±Ø¹Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ©
  score += Math.max(1, Math.floor(dt));
  if (score % 100 === 0) speed = Math.min(12, speed + 0.05);

  document.getElementById('score').textContent = score;

  if(score >= 10000 && !won){ endGame(true); return; }

  requestAnimationFrame(loop);
}

/* ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª ==================== */
function startGame(){
  if(running) return;
  // ØªÙ‡ÙŠØ¦Ø©
  speed = speedBase;
  score = 0; won=false; gameOver=false;
  rider.y = GROUND_Y() - rider.h; rider.vy=0; rider.onGround=true;
  obstacles.length=0;
  // Ø£ÙˆÙ„ Ø¹Ø§Ø¦Ù‚ Ø¨Ø¹ÙŠØ¯ + Ù…Ù‡Ù„Ø© Ø£Ù…Ø§Ù†
  for(let i=0;i<3;i++) spawnObstacle(i===0); // Ø§Ù„Ø£ÙˆÙ„ Ø¨Ø¹ÙŠØ¯ØŒ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù…ØªØ³Ù„Ø³Ù„
  safeUntil = performance.now() + SAFE_MS;

  overlay.classList.add('hidden');
  running = true; last = performance.now();
  requestAnimationFrame(loop);
}

function endGame(isWin){
  running=false; gameOver=!isWin; won=isWin;
  best = Math.max(best, score); localStorage.setItem('flyrider_best', best);
  document.getElementById('best').textContent = best;

  if(isWin){
    const msg = encodeURIComponent("Ø£Ù†Ø§ ÙƒØ³Ø¨Øª ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ÙÙŠ Ù„Ø¹Ø¨Ø© Fly Rider! âœ… Ø§Ù„Ù…Ø³Ø§ÙØ©: " + score + " Ù†Ù‚Ø·Ø©");
    showToast(
      'ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ© â€” Ø®ÙØ¯ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø© ÙˆØ§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ù†Ø§ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨.',
      'Ø£Ø±Ø³Ù„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨',
      ()=> window.open('https://wa.me/201017908076?text='+msg,'_blank')
    );
  }else{
    showToast('ğŸ’¥ Ø£ÙˆÙˆÙˆØ¨Ø³! Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ â€” Ø§Ø¶ØºØ·/Ø§Ù„Ù…Ø³ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©','Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©', resetGame);
  }
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£ÙˆÙØ±Ù„Ø§ÙŠ Ø¨Ø¹Ø¯ Ù„Ø­Ø¸Ø§Øª
  setTimeout(()=>overlay.classList.remove('hidden'),300);
}

function resetGame(){
  toast.classList.remove('show');
  startGame();
}

const toast = document.getElementById('toast');
function showToast(text, actionLabel, actionFn){
  toast.innerHTML = text + (actionLabel? `<div style="margin-top:8px"><button id="toastBtn" class="btn green">${actionLabel}</button></div>`:'');
  toast.classList.add('show');
  if(actionLabel) document.getElementById('toastBtn').onclick = actionFn;
}

overlay.addEventListener('pointerdown', ()=> gameOver ? resetGame() : startGame());

/* ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ Ù…ÙˆØ¶Ø¹ Ù„Ù„Ø§Ø¹Ø¨ */
rider.y = GROUND_Y() - rider.h;
</script>
</body>
</html>
