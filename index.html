<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fly Rider — العب واكسب توصيلة مجانية</title>
<style>
  :root{
    --ui:#0e2a3d; --text:#143a52; --muted:#537089;
    --chip:#fff; --chipb:#e7eff6;
    --accent:#22c55e; --danger:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui, -apple-system, "Segoe UI", Cairo, Roboto, sans-serif;
    color:var(--text); background:linear-gradient(#e9f6ff,#f9feff);
  }
  .wrap{max-width:960px;margin:0 auto;padding:16px}
  h1{margin:6px 0 10px;font-size:28px;color:var(--ui);display:flex;gap:8px;align-items:center}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .chip{background:var(--chip);border:1px solid var(--chipb);border-radius:14px;padding:10px 14px;font-weight:800;box-shadow:0 6px 16px rgba(0,0,0,.04)}
  .btn{background:var(--accent);color:#fff;font-weight:900;border:none;border-radius:999px;padding:10px 16px;cursor:pointer;box-shadow:0 10px 20px rgba(34,197,94,.35)}
  .btn:active{transform:translateY(1px)}
  .card{background:#ffffffaa;border:1px solid #e6eef5;border-radius:16px;padding:10px;backdrop-filter:blur(3px)}
  canvas{display:block;width:100%;max-width:960px;height:320px;border-radius:14px;border:1px solid #dfe8f0;background:transparent;box-shadow:0 12px 30px rgba(0,0,0,.06)}
  .overlay{position:absolute;inset:0;display:grid;place-items:center;text-align:center;background:rgba(255,255,255,.55);backdrop-filter:blur(2px);border-radius:14px;border:1px dashed #d9e6f2}
  .overlay.hidden{display:none}
  .tip{margin-top:10px;color:var(--muted);font-weight:700}
  .toast{position:fixed;inset:auto 12px 12px 12px;margin:auto;max-width:520px;background:#fff;border:1px solid #e6eef5;border-radius:14px;padding:12px 14px;box-shadow:0 18px 40px rgba(0,0,0,.12);display:none;text-align:center}
  .toast.show{display:block;animation:pop .3s ease}
  @keyframes pop{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between;align-items:center">
      <button id="btnStart" class="btn">ابدأ</button>
      <h1>🏍️ Fly Rider</h1>
    </div>

    <div class="row">
      <div class="chip">المسافة: <span id="dist">0</span> / 10000</div>
      <div class="chip">أعلى نتيجة: <span id="best">0</span></div>
    </div>

    <div class="card" style="position:relative;margin-top:12px">
      <canvas id="game" width="960" height="320" aria-label="Fly Rider Game"></canvas>
      <div id="overlay" class="overlay">
        <div>
          <div style="font-size:20px;font-weight:900;color:var(--ui)">اضغط أو المس للانطلاق</div>
          <div class="tip">الهدف: 10000 — اقفز وتفادى العوائق ✨</div>
        </div>
      </div>
    </div>

    <div class="tip">لو خبطت في عائق — اضغط الشاشة لإعادة المحاولة ✨</div>
  </div>

  <div id="toast" class="toast"></div>

<script>
/* ===== إعداد أساسي للكانفس مع دعم الشاشات العالية DPI ===== */
const canvas = document.getElementById('game');
const c = canvas.getContext('2d');
function fixDPI(){
  const dpr = window.devicePixelRatio || 1;
  const cssW = canvas.clientWidth, cssH = canvas.clientHeight;
  canvas.width = Math.round(cssW * dpr);
  canvas.height = Math.round(cssH * dpr);
  c.setTransform(dpr,0,0,dpr,0,0);
}
fixDPI(); addEventListener('resize', fixDPI);
const W = () => canvas.clientWidth, H = () => canvas.clientHeight;

/* ===== حالة اللعبة ===== */
let running=false, over=false, win=false;
let score=0, dist=0, best=parseInt(localStorage.getItem('fly_best')||'0',10);
document.getElementById('best').textContent = best;
const overlay = document.getElementById('overlay');
const toast = document.getElementById('toast');

/* ===== صورة اللاعب (الموتوسيكل) + بديل لو فشلت الصورة ===== */
const RIDER_URL = "https://i.ibb.co/0pCGtrP6/Picsart-25-10-16-11-05-31-905.png";
const riderImg = new Image();
riderImg.crossOrigin = 'anonymous';
riderImg.src = RIDER_URL;
let riderImgOk = true;
riderImg.onerror = ()=>{ riderImgOk=false; };

const groundY = () => H()*0.78;

const rider = {
  x: 80, y: 0, w: 72, h: 48,
  vy: 0, onGround: true, tilt: 0
};

const obstacles = [];
function spawnObstacle(){
  const gap = 140 + Math.random()*120;
  const last = obstacles[obstacles.length-1];
  const x = last ? last.x + gap + 50 + Math.random()*60 : W()+60;
  const h = 24 + Math.random()*36;
  const w = 22 + Math.random()*28;
  obstacles.push({x, y: groundY()-h, w, h});
}
for(let i=0;i<5;i++) spawnObstacle();

/* ===== رسم الخلفية والطريق ===== */
function drawBackground(){
  // سماء خفيفة
  const grd = c.createLinearGradient(0,0,0,H());
  grd.addColorStop(0,'#e8f5ff'); grd.addColorStop(.6,'#f5fbff'); grd.addColorStop(.6,'#d9e2ec');
  grd.addColorStop(.68,'#c8d4df'); grd.addColorStop(.68,'#e6eef5'); grd.addColorStop(1,'#bfe3b9');
  c.fillStyle = grd; c.fillRect(0,0,W(),H());

  // خط الأرض
  c.strokeStyle = '#c7d3df'; c.lineWidth = 2;
  c.beginPath(); c.moveTo(0, groundY()); c.lineTo(W(), groundY()); c.stroke();

  // ظل بيضاوي أسفل اللاعب
  c.fillStyle = 'rgba(0,0,0,.12)';
  c.beginPath();
  c.ellipse(rider.x + rider.w*0.6, groundY()+6, 42, 10, 0, 0, Math.PI*2);
  c.fill();
}

/* ===== رسم اللاعب ===== */
function drawRider(){
  c.save();
  const cx = rider.x + rider.w/2, cy = rider.y + rider.h/2;
  c.translate(cx, cy);
  c.rotate(rider.tilt);
  c.translate(-cx, -cy);

  if (riderImgOk){
    c.drawImage(riderImg, rider.x, rider.y, rider.w, rider.h);
  }else{
    // بديل بسيط: مستطيل أحمر + عجلات سوداء
    c.fillStyle = '#e11d48'; c.fillRect(rider.x, rider.y+8, rider.w-6, rider.h-12);
    c.fillStyle = '#111827';
    c.beginPath(); c.arc(rider.x+18, rider.y+rider.h-4, 8, 0, Math.PI*2); c.fill();
    c.beginPath(); c.arc(rider.x+rider.w-22, rider.y+rider.h-4, 8, 0, Math.PI*2); c.fill();
  }
  c.restore();
}

/* ===== رسم العوائق ===== */
function drawObstacles(speed){
  c.fillStyle = '#2c3e50';
  obstacles.forEach(o=>{ o.x -= speed; c.fillRect(o.x, o.y, o.w, o.h); });
  while(obstacles.length && obstacles[0].x + obstacles[0].w < -20){ obstacles.shift(); spawnObstacle(); }
}

/* ===== تحكم القفز ===== */
function jump(){
  if (!running) startGame();
  if (!rider.onGround || over) return;
  rider.vy = -12.5; rider.onGround = false;
  rider.tilt = -0.18; // ميل خفيف وقت القفزة
}
addEventListener('keydown', e=>{
  if ([' ','ArrowUp','w','W'].includes(e.key)){ e.preventDefault(); jump(); }
  if ((e.key==='r' || e.key==='R') && over){ resetGame(); }
});
canvas.addEventListener('pointerdown', jump);
document.getElementById('btnStart').addEventListener('click', jump);

/* ===== فيزياء + تصادم ===== */
function physics(){
  rider.vy += 0.7;
  rider.y += rider.vy;

  // رجّع الميل تدريجي
  if (rider.tilt < 0) rider.tilt += 0.02;
  if (rider.tilt > 0) rider.tilt = 0;

  if (rider.y + rider.h >= groundY()){
    rider.y = groundY() - rider.h;
    rider.vy = 0; rider.onGround = true; rider.tilt = 0;
  }

  // AABB Collision
  const rx = rider.x+10, ry = rider.y+6, rw = rider.w-20, rh = rider.h-10;
  for (const o of obstacles){
    if (rx < o.x + o.w && rx + rw > o.x && ry < o.y + o.h && ry + rh > o.y){
      endGame(false);
      break;
    }
  }
}

/* ===== حلقة اللعبة ===== */
let last=0, speed=6;
function loop(ts){
  if (!running) return;
  const dt = (ts-last)/16.67; last=ts;

  c.clearRect(0,0,W(),H());
  drawBackground();
  drawObstacles(speed);
  physics();
  drawRider();

  // نقاط ومسافة
  const inc = Math.max(1, Math.floor(dt));
  score += inc; dist += inc;
  if (score % 120 === 0) speed = Math.min(12, speed + 0.05);

  document.getElementById('dist').textContent = dist;

  if (dist >= 10000 && !win){ endGame(true); return; }

  requestAnimationFrame(loop);
}

/* ===== إدارة الحالة ===== */
function startGame(){
  if (running) return;
  overlay.classList.add('hidden');
  running = true; over=false; win=false; last = performance.now();
  requestAnimationFrame(loop);
}
function endGame(isWin){
  running=false; over=true; win=isWin;
  best = Math.max(best, dist); localStorage.setItem('fly_best', best);
  document.getElementById('best').textContent = best;

  if (isWin){
    showToast('🎉 مبروك! كسبت توصيله مجانية — هيتم تحويلك للواتساب الآن ✅');
    // تحويل واتساب مع رسالة جاهزة
    const msg = encodeURIComponent('أنا كسبت توصيله مجانية من لعبة Fly Rider ✅');
    setTimeout(()=>{ location.href = `https://wa.me/201017908076?text=${msg}`; }, 900);
  }else{
    showToast('💥 أووبس! حاول تاني — اضغط لإعادة المحاولة');
    setTimeout(()=> overlay.classList.remove('hidden'), 200);
  }
}
function resetGame(){
  score=0; dist=0; speed=6;
  rider.y = groundY()-rider.h; rider.vy=0; rider.onGround=true; rider.tilt=0;
  obstacles.length=0; for(let i=0;i<5;i++) spawnObstacle();
  overlay.classList.add('hidden'); toast.classList.remove('show');
  running=true; over=false; win=false; last=performance.now();
  requestAnimationFrame(loop);
}
overlay.addEventListener('pointerdown', ()=> over ? resetGame() : startGame());

function showToast(msg){ toast.textContent = msg; toast.classList.add('show'); }

/* موضع أولي */
rider.y = groundY() - rider.h;
</script>
</body>
</html>
