<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fly Rider â€” Ø§Ù„Ø¹Ø¨ ÙˆØ§Ø±Ø¨Ø­ ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ©</title>
<style>
  :root{
    --sky1:#bfe6ff; --sky2:#f7fbff;
    --ground:#8bd17c; --road:#d9dfe8; --lane:#b7c3cf;
    --text:#063451; --ui:#0e2a3d; --accent:#2ecc71; --danger:#e74c3c; --brand:#24c36b;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,var(--sky1),var(--sky2));
    font-family:system-ui,-apple-system,"Segoe UI",Cairo,Roboto,sans-serif;
    color:var(--text); overflow:hidden;
  }
  .bg{
    position:fixed; inset:0; z-index:0; overflow:hidden;
    background: linear-gradient(180deg, var(--sky1) 0%, var(--sky2) 60%, var(--road) 60%, var(--lane) 68%, var(--road) 68%, var(--ground) 100%);
  }
  .cloud{position:absolute; top:10%; width:180px; height:60px; background:#fff; border-radius:40px; opacity:.9}
  .cloud:before,.cloud:after{content:""; position:absolute; background:#fff; border-radius:50%}
  .cloud:before{width:80px;height:80px; left:20px; top:-30px}
  .cloud:after{width:60px;height:60px; left:100px; top:-20px}
  .cloud.s1{top:12%; left:110%; animation:cloud 28s linear infinite}
  .cloud.s2{top:20%; left:130%; transform:scale(.8); animation:cloud 36s linear infinite}
  .cloud.s3{top:26%; left:150%; transform:scale(1.1); animation:cloud 42s linear infinite}
  @keyframes cloud{to{transform:translateX(-260%)}}

  .wrap{max-width:960px; margin:0 auto; padding:18px; position:relative; z-index:1}
  h1{margin:4px 0 8px; font-size:24px; font-weight:900; color:var(--ui); display:flex; gap:8px; align-items:center; justify-content:space-between;}
  .hud{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .badge{background:#fff;border:1px solid #e6eef5; padding:8px 12px; border-radius:12px; font-weight:800; color:var(--ui); box-shadow:0 6px 16px rgba(0,0,0,.05)}
  .btn{background:var(--accent); color:#fff; font-weight:900; border:none; border-radius:999px; padding:10px 16px; cursor:pointer; box-shadow:0 10px 20px rgba(46,204,113,.35)}
  .btn:active{transform:translateY(1px)}
  canvas{display:block; width:100%; max-width:960px; height:280px; border-radius:16px; background:transparent; border:1px solid #dfe8f0; box-shadow:0 12px 30px rgba(0,0,0,.06)}

  .overlay{
    position:absolute; inset:0; display:grid; place-items:center; text-align:center;
    background:rgba(255,255,255,.55); backdrop-filter:blur(3px); border-radius:16px; border:1px dashed #cfe0ed;
    color:var(--ui); font-weight:900; z-index:1;
  }
  .overlay.hidden{display:none}
  .overlay .inner{padding:14px}
  .small{font-size:12px; opacity:.8; margin-top:6px}

  .toast{position:fixed; inset:auto 12px 12px 12px; margin:auto; max-width:520px; background:#fff; border:1px solid #e6eef5; border-radius:16px; padding:14px 16px; box-shadow:0 18px 40px rgba(0,0,0,.12); display:none; text-align:center; z-index:2;}
  .toast.show{display:block; animation:pop .35s ease}
  @keyframes pop{from{transform:translateY(12px);opacity:0}to{transform:translateY(0);opacity:1}}

  .audio-toggle{position:fixed; top:10px; left:10px; z-index:3; background:#fff; border:1px solid #e6eef5; border-radius:999px; padding:8px 12px; font-weight:800; cursor:pointer}
</style>
</head>
<body>
  <div class="bg">
    <div class="cloud s1"></div><div class="cloud s2"></div><div class="cloud s3"></div>
  </div>

  <button id="audioBtn" class="audio-toggle">ğŸ”Š ØµÙˆØª</button>

  <div class="wrap">
    <h1>ğŸ® Fly Rider <button id="btnStart" class="btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button></h1>
    <div class="hud">
      <div class="badge">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
      <div class="badge">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: <span id="best">0</span></div>
      <div class="badge">Ø§Ù„Ù‡Ø¯Ù: 3000 Ù†Ù‚Ø·Ø©</div>
      <div class="badge">Ø§Ù„Ù‚ÙØ²: Ø§Ù„Ù…Ø³Ø§ÙØ©/Ø³Ù‡Ù… â†‘ Ø£Ùˆ Ù„Ù…Ø³Ø©</div>
    </div>

    <div style="position:relative">
      <canvas id="game" width="960" height="280" aria-label="Fly Rider Game"></canvas>
      <div id="overlay" class="overlay">
        <div class="inner">
          <div style="font-size:20px; margin-bottom:6px">
            Ø§Ø¶ØºØ· <span style="color:#2ecc71">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</span> Ø£Ùˆ Ø§Ù„Ù…Ø³ Ø§Ù„Ø´Ø§Ø´Ø©
          </div>
          <div class="small">Ø§Ù‚ÙØ² ÙÙˆÙ‚ Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚. Ù„Ùˆ ÙˆØµÙ„Øª 3000 Ù†Ù‚Ø·Ø©: <span style="color:#e67e22">Ù…Ø¨Ø±ÙˆÙƒ ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ©!</span></div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

<script>
/* ====== Ø£ØµÙˆØ§Øª WebAudio ====== */
let AC, ctx, master;
function audioInit(){
  if (ctx) return;
  AC = window.AudioContext || window.webkitAudioContext;
  if (!AC) return;
  ctx = new AC();
  master = ctx.createGain(); master.gain.value = 0.2; master.connect(ctx.destination);
}
function tone(freq=880, dur=0.12, type='square'){
  if (!ctx) return;
  const o=ctx.createOscillator(), g=ctx.createGain();
  o.type=type; o.frequency.value=freq; o.connect(g); g.connect(master);
  g.gain.setValueAtTime(0.0001, ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(.6, ctx.currentTime+.01);
  g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+dur);
  o.start(); o.stop(ctx.currentTime+dur+.02);
}
const sfx = { jump(){tone(900,.09,'square')}, hit(){tone(180,.2,'sawtooth'); setTimeout(()=>tone(140,.15,'sawtooth'),90)}, win(){tone(660,.15,'sine'); setTimeout(()=>tone(990,.18,'sine'),120)} };

/* Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø®ÙÙŠÙØ© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© */
const bg = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_20a9db379e.mp3?filename=upbeat-driving-rock-11284.mp3');
bg.loop = true; bg.volume = .26;
function tryPlayBG(){ bg.play().catch(()=>{}); }
['pointerdown','touchstart','click'].forEach(ev=>addEventListener(ev,()=>{audioInit(); tryPlayBG();},{once:true}));
document.getElementById('audioBtn').addEventListener('click',()=>{
  bg.muted = !bg.muted;
  audioInit();
  if(!bg.muted) tryPlayBG();
  document.getElementById('audioBtn').textContent = bg.muted ? 'ğŸ”‡ ØµØ§Ù…Øª' : 'ğŸ”Š ØµÙˆØª';
});

/* ====== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù†ÙØ³ ÙˆØ§Ù„Ù„Ø¹Ø¨Ø© ====== */
const canvas = document.getElementById('game'), c = canvas.getContext('2d');
const dpi = devicePixelRatio||1;
function fixDPI(){ const ch=canvas.clientHeight, cw=canvas.clientWidth; canvas.width=Math.round(cw*dpi); canvas.height=Math.round(ch*dpi); c.setTransform(dpi,0,0,dpi,0,0); }
fixDPI(); addEventListener('resize', fixDPI);
const W=()=>canvas.clientWidth, H=()=>canvas.clientHeight;

let running=false, gameOver=false, won=false;
let score=0, best=parseInt(localStorage.getItem('flyrider_best')||'0',10);
document.getElementById('best').textContent = best;

const GROUND_Y = ()=> H()*0.78;
let speed=6;

/* ====== Ø³ÙƒÙˆØªØ± Ø§Ù„ØªÙˆØµÙŠÙ„ (ÙÙŠÙƒØªÙˆØ±) ====== */
const rider = { x:80, y:0, w:130, h:95, vy:0, onGround:true, wheelAngle:0 };

function drawWheel(cx, cy, r, angle){
  // Ø¥Ø·Ø§Ø±
  c.fillStyle='#0f1722';
  c.beginPath(); c.arc(cx,cy,r,0,Math.PI*2); c.fill();
  // Ø¬Ù†Ø·
  c.fillStyle='#2b3a4a';
  c.beginPath(); c.arc(cx,cy,r*0.65,0,Math.PI*2); c.fill();
  // Ø£Ø°Ø±Ø¹ Ù…ØªØ­Ø±ÙƒØ© Ø­Ø³Ø¨ angle
  c.save();
  c.translate(cx,cy); c.rotate(angle);
  c.strokeStyle='#e6edf5'; c.lineWidth=2;
  for(let i=0;i<4;i++){ c.beginPath(); c.moveTo(0,0); c.lineTo(r*0.6,0); c.stroke(); c.rotate(Math.PI/2); }
  c.restore();
  // ÙƒØ¨Ø³ Ø§Ù„Ø¬Ù†Ø·
  c.fillStyle='#d5dee8'; c.beginPath(); c.arc(cx,cy,r*0.22,0,Math.PI*2); c.fill();
}

function drawScooter(x,y,w,h,air,t){
  const lean = air ? Math.sin(t/120)*0.18 : 0;   // Ù…ÙŠÙ„Ø§Ù† ÙÙŠ Ø§Ù„Ù‡ÙˆØ§
  c.save();
  if(air){ c.translate(x+w/2, y+h/2); c.rotate(lean); c.translate(-(x+w/2), -(y+h/2)); }

  // Ø¸Ù„ ØªØ­Øª Ø§Ù„Ø³ÙƒÙˆØªØ±
  const sh = rider.onGround ? 1 : Math.max(.6, 1-((GROUND_Y()-(y+h))/150));
  c.fillStyle='rgba(0,0,0,.14)'; c.beginPath();
  c.ellipse(x+w*0.55, GROUND_Y()+7, 44*sh, 10*sh, 0, 0, Math.PI*2); c.fill();

  // Ø§Ù„Ø¹Ø¬Ù„
  const r = h*0.26;
  drawWheel(x+w*0.25, y+h*0.85, r, rider.wheelAngle);
  drawWheel(x+w*0.78, y+h*0.88, r, rider.wheelAngle);

  // Ø§Ù„Ø´Ø§Ø³ÙŠÙ‡
  c.fillStyle='#2c3e50'; c.fillRect(x+w*0.22, y+h*0.68, w*0.6, 10);
  c.fillStyle='#36495e'; c.fillRect(x+w*0.28, y+h*0.63, w*0.46, 8);

  // Ø§Ù„Ø¨Ø¯Ù‘Ø§Ù„Ø§Øª/Ù…Ø³Ù†Ø¯ Ø§Ù„Ù‚Ø¯Ù…
  c.fillStyle='#1b2836'; c.fillRect(x+w*0.40, y+h*0.70, w*0.2, 8);

  // Ø¬Ø³Ù… Ø§Ù„Ø³ÙƒÙˆØªØ±
  const grad = c.createLinearGradient(x,y,x+w,y);
  grad.addColorStop(0,'#18b06b'); grad.addColorStop(1,'#24c36b');
  c.fillStyle = grad;
  c.beginPath();
  c.roundRect(x+w*0.35, y+h*0.40, w*0.35, h*0.28, 10); c.fill();

  // Ø§Ù„Ù…Ù‚ÙˆØ¯
  c.strokeStyle='#a8b5c3'; c.lineWidth=5;
  c.beginPath(); c.moveTo(x+w*0.60, y+h*0.40); c.lineTo(x+w*0.70, y+h*0.26); c.stroke();
  c.lineWidth=4;
  c.beginPath(); c.moveTo(x+w*0.70, y+h*0.26); c.lineTo(x+w*0.78, y+h*0.24); c.stroke();

  // ÙƒØ´Ø§Ù
  c.fillStyle='#fef3c7'; c.beginPath(); c.arc(x+w*0.82, y+h*0.24, 10, 0, Math.PI*2); c.fill();
  c.strokeStyle='#e2e8f0'; c.stroke();

  // ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙˆØµÙŠÙ„
  c.fillStyle='#24c36b';
  c.fillRect(x+w*0.20, y+h*0.28, w*0.22, h*0.20);
  c.fillStyle='#0ea85a';
  c.fillRect(x+w*0.20, y+h*0.28, w*0.22, 8);

  // Ø§Ù„Ø³Ø§Ø¦Ù‚
  // Ø±Ø¬Ù„ÙŠÙ†
  c.fillStyle='#0f1722';
  c.fillRect(x+w*0.48, y+h*0.55, 10, 26);
  c.fillRect(x+w*0.56, y+h*0.54, 10, 28);
  // Ø­Ø°Ø§Ø¡
  c.fillStyle='#1f2937';
  c.fillRect(x+w*0.47, y+h*0.80, 22, 8);
  c.fillRect(x+w*0.56, y+h*0.79, 22, 8);
  // ØªÙŠØ´ÙŠØ±Øª
  c.fillStyle='#1e40af';
  c.beginPath(); c.roundRect(x+w*0.50, y+h*0.34, w*0.20, h*0.18, 8); c.fill();
  // Ø°Ø±Ø§Ø¹ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù‚ÙˆØ¯
  c.fillStyle='#f5c9a8';
  c.fillRect(x+w*0.62, y+h*0.38, 10, 24);
  c.fillRect(x+w*0.68, y+h*0.29, 10, 22);
  // Ø±Ø£Ø³ + Ø®ÙˆØ°Ø©
  c.fillStyle='#f5c9a8'; c.beginPath(); c.arc(x+w*0.58, y+h*0.30, 11, 0, Math.PI*2); c.fill();
  c.fillStyle='#d1d8e0'; c.beginPath(); c.arc(x+w*0.58, y+h*0.27, 14, 0, Math.PI*2); c.fill();
  c.fillStyle='#3867d6'; c.beginPath(); c.arc(x+w*0.58, y+h*0.27, 9, 0, Math.PI*2); c.fill();

  c.restore();
}

/* ====== Ø¹ÙˆØ§Ø¦Ù‚ ÙˆØ·Ø±ÙŠÙ‚ ====== */
const obstacles=[];
function spawnObstacle(){
  const gap=140+Math.random()*120;
  const last=obstacles[obstacles.length-1];
  const x = last? last.x + gap + 40 + Math.random()*80 : W()+60;
  const h = 30 + Math.random()*35, w = 26 + Math.random()*30;
  obstacles.push({x, y:GROUND_Y()-h, w, h});
}
for(let i=0;i<5;i++) spawnObstacle();

const groundDots=Array.from({length:24},(_,i)=>({x:i*60+Math.random()*50, y:GROUND_Y()+12+Math.random()*16}));

function drawBackground(){
  const y=GROUND_Y();
  c.strokeStyle='#c6d0db'; c.lineWidth=2;
  c.beginPath(); c.moveTo(0,y); c.lineTo(W(),y); c.stroke();

  c.fillStyle='#fff';
  const segW=40, gap=70, off=-(Date.now()/20 % (segW+gap));
  for(let x=off; x<W(); x+=segW+gap) c.fillRect(x, y-6, segW, 3);

  c.fillStyle='#a7b4c1';
  groundDots.forEach(d=>{
    d.x -= speed*.3; if(d.x<-10) d.x=W()+Math.random()*60;
    c.fillRect(d.x, y+8+Math.sin(d.x*.05)*2, 6, 2);
  });
}

function drawObstacles(){
  c.fillStyle='#2c3e50';
  obstacles.forEach(o=>{ o.x -= speed; c.fillRect(o.x,o.y,o.w,o.h); });
  while(obstacles.length && obstacles[0].x+obstacles[0].w<-20){ obstacles.shift(); spawnObstacle(); }
}

/* ====== ØªØ­ÙƒÙ… ÙˆÙ‚ÙˆØ§Ù†ÙŠÙ† ====== */
function jump(){
  if(!running) startGame();
  if(!rider.onGround || gameOver) return;
  rider.vy=-13; rider.onGround=false; sfx.jump();
}
addEventListener('keydown',e=>{
  if([' ','ArrowUp','w','W'].includes(e.key)){ e.preventDefault(); jump(); }
  if((e.key==='r'||e.key==='R')&&gameOver) resetGame();
});
canvas.addEventListener('pointerdown', jump);
document.getElementById('btnStart').addEventListener('click', jump);

function physics(){
  rider.vy += 0.7;
  rider.y += rider.vy;
  if(rider.y + rider.h >= GROUND_Y()){
    rider.y = GROUND_Y()-rider.h;
    rider.vy = 0; rider.onGround=true;
  }
  // ØªØµØ§Ø¯Ù… (ØµÙ†Ø¯ÙˆÙ‚ Ø£ØµØºØ± Ø´ÙˆÙŠØ© Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ù„Ø¹Ø¨)
  const rx=rider.x+18, ry=rider.y+10, rw=rider.w-36, rh=rider.h-18;
  for(const o of obstacles){
    if (rx < o.x+o.w && rx+rw>o.x && ry < o.y+o.h && ry+rh>o.y){
      endGame(false); break;
    }
  }
}

let lastTime=0;
function loop(ts){
  if(!running) return;
  const dt=(ts-lastTime)/16.67; lastTime=ts;

  c.clearRect(0,0,W(),H());
  drawBackground(); drawObstacles(); physics();

  // Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ø¬Ù„Ø§Øª
  rider.wheelAngle -= speed*0.15;
  // Bobbing Ø¨Ø³ÙŠØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶
  const bob = rider.onGround? Math.sin(Date.now()/180)*1.6 : 0;
  drawScooter(rider.x, rider.y + bob, rider.w, rider.h, !rider.onGround, ts);

  score += Math.max(1, Math.floor(dt));
  if(score%100===0) speed=Math.min(12, speed+.05);
  document.getElementById('score').textContent=score;

  if(score>=3000 && !won){ endGame(true); return; }
  requestAnimationFrame(loop);
}

const overlay=document.getElementById('overlay');
const toast=document.getElementById('toast');

function startGame(){
  if(running) return;
  overlay.classList.add('hidden');
  running=true; gameOver=false; won=false; lastTime=performance.now();
  requestAnimationFrame(loop);
}
function endGame(isWin){
  running=false; gameOver=true; won=isWin;
  best=Math.max(best,score); localStorage.setItem('flyrider_best',best);
  document.getElementById('best').textContent=best;
  if(isWin){ showToast('ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ğŸšš'); sfx.win(); }
  else{ showToast('ğŸ’¥ Ø®Ø¨Ø·Øª ÙÙŠ Ø¹Ø§Ø¦Ù‚ â€” Ø§Ø¶ØºØ· Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©'); sfx.hit(); }
  setTimeout(()=>overlay.classList.remove('hidden'),200);
}
function resetGame(){
  score=0; speed=6;
  rider.y=GROUND_Y()-rider.h; rider.vy=0; rider.onGround=true; rider.wheelAngle=0;
  obstacles.length=0; for(let i=0;i<5;i++) spawnObstacle();
  overlay.classList.add('hidden'); toast.classList.remove('show');
  running=true; gameOver=false; won=false; lastTime=performance.now();
  requestAnimationFrame(loop);
}
overlay.addEventListener('pointerdown', ()=> gameOver ? resetGame() : startGame());

function showToast(msg){ toast.textContent=msg; toast.classList.add('show'); }

/* Ø¨Ø¯Ø¡ Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ */
rider.y=GROUND_Y()-rider.h;
</script>
</body>
</html>
