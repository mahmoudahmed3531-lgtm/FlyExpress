<script>
(function(){
  const SOUND_URL = 'https://media1.vocaroo.com/mp3/1jO9G1TYLBJ'; // رابط الصوت المباشر
  const DELAY_MS = 1500; // مدة الانتظار قبل الانتقال (عدّلها لو حابب)

  // نستخدم عنصر صوت واحد عشان iOS وبعض المتصفحات
  const audio = new Audio(SOUND_URL);
  audio.preload = 'auto';

  function handleClick(e){
    const a = e.currentTarget;
    const href = a.href;
    const openInNewTab = (a.getAttribute('target') === '_blank');

    e.preventDefault();

    // لو مطلوب تبويب جديد: نفتحه "فور النقر" عشان ما يتمنعش
    let newWin = null;
    if (openInNewTab) {
      newWin = window.open('about:blank', '_blank', 'noopener'); 
      if (!newWin) {
        // المتصفح منع الفتح؛ نرجع نفتح في نفس التبويب كحل بديل
        newWin = null;
      }
    }

    // شغّل الصوت
    const startTime = Date.now();
    audio.currentTime = 0;
    audio.play()
      .catch(() => {})  // لو اترفض التشغيل هنكمل بالتايمر/الانتقال
      .finally(() => {
        // ننتظر لأقلّه DELAY_MS أو انتهاء الصوت — اللي ييجي أولاً
        const safetyTimer = setTimeout(go, DELAY_MS);

        function go(){
          clearTimeout(safetyTimer);
          if (newWin) {
            newWin.location.href = href;
          } else {
            window.location.href = href;
          }
        }

        // لو الصوت انتهى بدري، ننتقل مباشرة
        audio.onended = () => {
          // لو الصوت أقصر من DELAY_MS، ننقل فورًا
          if (Date.now() - startTime < DELAY_MS) {
            if (newWin) newWin.location.href = href;
            else window.location.href = href;
          }
        };
      });
  }

  // اربط الحدث بكل الروابط اللي عليها .btn
  document.querySelectorAll('a.btn[href]').forEach(a=>{
    if (!a.dataset.soundBound) {
      a.addEventListener('click', handleClick);
      a.dataset.soundBound = '1';
    }
  });
})();
</script>
