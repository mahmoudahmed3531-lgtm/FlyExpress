<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>سجل الفائزين — Fly Express</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root{--bg:#06131b;--card:rgba(255,255,255,.06);--line:rgba(255,255,255,.12);--ok:#00ffaa;--bad:#ff4d7a;--muted:#b8c0c9}
  *{box-sizing:border-box}body{margin:0;font-family:'Cairo',system-ui,sans-serif;background:radial-gradient(1000px 600px at 10% 10%,#0b2a3b 0%,transparent 65%),radial-gradient(1000px 600px at 90% 90%,#031a25 0%,transparent 65%),linear-gradient(160deg,#06131b,#081824);color:#eaf1f6;min-height:100svh;padding:20px}
  .wrap{max-width:960px;margin:auto}
  h1{margin:0 0 10px;font-size:28px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin:12px 0;box-shadow:0 18px 40px rgba(0,0,0,.25)}
  .row{display:grid;gap:10px;grid-template-columns:repeat(4,1fr);margin-top:8px}
  input,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:rgba(255,255,255,.06);color:#fff}
  .btn{background:linear-gradient(90deg,#00ffaa,#00a8ff);color:#012;font-weight:900;border:none;border-radius:999px;padding:10px 16px;cursor:pointer}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid var(--line);padding:10px;text-align:center}
  th{color:#a9ffea}
  .tools{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .danger{background:linear-gradient(90deg,#ff6b81,#ff4757);color:#fff}
  .muted{color:var(--muted);font-weight:800}
  .small{font-size:12px;color:#93a4b2}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid var(--line);font-weight:800}
</style>
</head>
<body>
<div class="wrap">
  <h1>🏆 سجل الفائزين — Fly Express</h1>
  <div class="card">
    <div class="small">ضيف الفائزين يدويًا أو ابعت البيانات بالرابط: <span class="pill">winners.html?name=Ali&phone=010&game=Whack&score=4200</span></div>
    <div class="row">
      <input id="name"  placeholder="الاسم الكامل">
      <input id="phone" placeholder="رقم الموبايل">
      <select id="game">
        <option>Whack-a-Parcel</option>
        <option>Fly Rider</option>
      </select>
      <input id="score" placeholder="النتيجة">
    </div>
    <div class="tools" style="margin-top:10px">
      <button class="btn" id="add">إضافة للسجل</button>
      <button class="btn" id="export">تصدير CSV</button>
      <input id="search" placeholder="بحث بالاسم/الرقم/اللعبة" style="flex:1">
      <button class="btn danger" id="clearAll">مسح السجل بالكامل</button>
    </div>
    <div class="small">البيانات محفوظة محليًا على جهازك (LocalStorage). للتجميع المركزي محتاج سيرفر بسيط—لو حابب أجهزه لك قولي.</div>
  </div>

  <div class="card">
    <table id="tbl">
      <thead>
        <tr><th>#</th><th>الاسم</th><th>الموبايل</th><th>اللعبة</th><th>النتيجة</th><th>التاريخ</th><th>إجراءات</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="muted" id="empty" style="display:none;text-align:center;padding:10px">لا يوجد بيانات بعد.</div>
  </div>
</div>

<script>
const KEY='winners_log';
const $=s=>document.querySelector(s);
const $$=s=>document.querySelectorAll(s);
const nameI=$('#name'), phoneI=$('#phone'), gameI=$('#game'), scoreI=$('#score');
const addB=$('#add'), exportB=$('#export'), clearB=$('#clearAll'), searchI=$('#search');
const bodyT=$('#tbl tbody'), empty=$('#empty');

function load(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch{ return [] } }
function save(list){ localStorage.setItem(KEY, JSON.stringify(list)) }
function nowStr(){ const d=new Date(); return d.toLocaleString('ar-EG') }

function render(){
  const q = (searchI.value||'').trim().toLowerCase();
  const list = load();
  bodyT.innerHTML='';
  let shown=0;
  list.forEach((r,i)=>{
    const rowStr = [r.name,r.phone,r.game,String(r.score),r.date].join(' ').toLowerCase();
    if(q && !rowStr.includes(q)) return;
    shown++;
    const tr=document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${r.name}</td>
      <td>${r.phone}</td>
      <td><span class="pill">${r.game}</span></td>
      <td>${r.score}</td>
      <td>${r.date}</td>
      <td><button class="btn danger" data-i="${i}">حذف</button></td>`;
    bodyT.appendChild(tr);
  });
  empty.style.display = (shown===0)?'block':'none';
}
render();

bodyT.addEventListener('click', e=>{
  if(e.target.matches('button[data-i]')){
    const i=+e.target.dataset.i;
    const list=load(); list.splice(i,1); save(list); render();
  }
});

addB.addEventListener('click', ()=>{
  const name=nameI.value.trim(), phone=phoneI.value.trim(), game=gameI.value, score=+scoreI.value||0;
  if(!name || !phone){ alert('من فضلك اكتب الاسم والرقم.'); return; }
  const list=load();
  list.unshift({name,phone,game,score,date:nowStr()});
  save(list); render();
  nameI.value=''; phoneI.value=''; scoreI.value='';
});

clearB.addEventListener('click', ()=>{
  if(confirm('مسح كل السجل؟')){ localStorage.removeItem(KEY); render(); }
});

searchI.addEventListener('input', render);

exportB.addEventListener('click', ()=>{
  const list=load();
  if(!list.length) return alert('لا يوجد بيانات للتصدير.');
  const header=['name','phone','game','score','date'];
  const rows=[header.join(',')].concat(list.map(r=>header.map(k=>`"${String(r[k]).replace(/"/g,'""')}"`).join(',')));
  const blob=new Blob([rows.join('\n')],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='winners.csv'; a.click();
  URL.revokeObjectURL(url);
});

// التقاط بيانات من عنوان الرابط ?name=&phone=&game=&score=
(function fromQuery(){
  const p=new URLSearchParams(location.search);
  if(!p.has('name')) return;
  const rec={
    name: p.get('name')||'مجهول',
    phone: p.get('phone')||'—',
    game: p.get('game')||'—',
    score: +(p.get('score')||0),
    date: nowStr()
  };
  const list=load(); list.unshift(rec); save(list); render();
})();
</script>
</body>
</html>
