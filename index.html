<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fly Rider â€” Ø§Ù„Ø·Ø±ÙŠÙ‚ Ù„Ù„Ù€ 10,000</title>
<style>
  :root{
    --sky1:#cfeaff; --sky2:#f7fbff;
    --ground:#8bd17c; --road:#d9dfe8; --lane:#b7c3cf;
    --ui:#0f2a3d; --text:#063451; --accent:#2ecc71; --danger:#e74c3c;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; font-family:system-ui, "Cairo", Segoe UI, Roboto, sans-serif; color:var(--text); background:linear-gradient(#eaf6ff,#ffffff); overflow:hidden}
  .wrap{max-width:1000px; margin:0 auto; padding:16px}
  h1{display:flex;gap:8px;align-items:center;justify-content:space-between;margin:0 0 8px;font-size:24px;color:var(--ui);font-weight:900}
  .hud{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .badge{background:#fff;border:1px solid #e6eef5;padding:8px 12px;border-radius:12px;font-weight:800;color:var(--ui);box-shadow:0 6px 16px rgba(0,0,0,.05)}
  .btn{background:var(--accent);color:#fff;border:none;border-radius:999px;padding:9px 14px;font-weight:900;cursor:pointer;box-shadow:0 10px 20px rgba(46,204,113,.35)}
  .btn:active{transform:translateY(1px)}
  #game{display:block;width:100%;max-width:1000px;height:320px;background:transparent;border:1px solid #dfe8f0;border-radius:16px;box-shadow:0 12px 30px rgba(0,0,0,.06)}
  .overlay{position:absolute;inset:0;display:grid;place-items:center;text-align:center;background:rgba(255,255,255,.55);backdrop-filter:blur(3px);border-radius:16px;border:1px dashed #cfe0ed;color:var(--ui);font-weight:900}
  .overlay.hidden{display:none}
  .toast{position:fixed;inset:auto 12px 12px 12px;background:#fff;border:1px solid #e6eef5;border-radius:16px;padding:14px 16px;box-shadow:0 18px 40px rgba(0,0,0,.12);text-align:center;display:none}
  .toast.show{display:block;animation:pop .35s ease}
  @keyframes pop{from{transform:translateY(12px);opacity:0}to{transform:translateY(0);opacity:1}}
  /* Ø®Ù„ÙÙŠØ© Ø³Ø­Ø§Ø¨ */
  .cloud{position:absolute;top:10%;width:180px;height:60px;background:#fff;border-radius:40px;filter:blur(.2px);opacity:.9}
  .cloud:before,.cloud:after{content:"";position:absolute;background:#fff;border-radius:50%}
  .cloud:before{width:80px;height:80px;left:20px;top:-30px}
  .cloud:after{width:60px;height:60px;left:100px;top:-20px}
  .s1{top:12%;left:110%;animation:cloud 28s linear infinite}
  .s2{top:20%;left:130%;transform:scale(.8);animation:cloud 36s linear infinite}
  .s3{top:26%;left:150%;transform:scale(1.1);animation:cloud 42s linear infinite}
  @keyframes cloud{to{transform:translateX(-260%)}}
</style>
</head>
<body>
  <div class="wrap">
    <h1>
      ğŸï¸ Fly Rider
      <span>
        <button id="btnMusic" class="btn" style="background:#5b8def">ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ğŸ”Š</button>
        <button id="btnStart" class="btn">Ø§Ø¨Ø¯Ø£</button>
      </span>
    </h1>

    <div class="hud">
      <div class="badge">Ø§Ù„Ù…Ø³Ø§ÙØ©: <span id="score">0</span> / 10000</div>
      <div class="badge">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: <span id="best">0</span></div>
      <div class="badge">Ø§Ù„Ù‚ÙØ²: Ø§Ù„Ù…Ø³Ø§ÙØ©/Ø³Ù‡Ù… â†‘ Ø£Ùˆ Ù„Ù…Ø³Ø©</div>
      <div class="badge">Ø£Ø¹Ø¯Ø§Ø¡ Ø·Ø§Ø¦Ø±Ø© + Ø±ØµØ§ØµØŒ ØªÙØ§Ø¯Ø§Ù‡Ù… Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù†Ù‡Ø§ÙŠØ©</div>
    </div>

    <div style="position:relative">
      <canvas id="game" width="1000" height="320" aria-label="Fly Rider Game"></canvas>
      <div class="overlay" id="overlay">
        <div>
          Ø§Ø¶ØºØ· <b style="color:#2ecc71">Ø§Ø¨Ø¯Ø£</b> Ø£Ùˆ Ø§Ù„Ù…Ø³ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚<br>
          Ø§Ù„Ù‡Ø¯Ù: <b>10,000</b> Ù†Ù‚Ø·Ø© â€” ÙŠØ§ÙØ·Ø© Ø¨Ù„Ø¯ ÙƒÙ„ <b>1000</b><br>
          ØªÙØ§Ø¯Ù‰ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„Ø±ØµØ§Øµ ğŸ‘€
        </div>
      </div>
      <div class="cloud s1"></div>
      <div class="cloud s2"></div>
      <div class="cloud s3"></div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <!-- Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø®Ù„ÙÙŠØ© (ØºÙŠÙ‘Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ùˆ Ø¹Ø§ÙŠØ² Ù…Ù‚Ø·Ø¹Ùƒ) -->
  <audio id="bgm" loop preload="auto"
    src="https://cdn.pixabay.com/download/audio/2021/12/22/audio_c2a1f8e6c8.mp3?filename=lofi-study-112191.mp3"></audio>

<script>
/* ============ Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ============ */
const GOAL = 10000;
const SIGN_STEP = 1000;
const SIGN_NAMES = [
  "Ù†Ø¬Ø¹ Ø­Ù…Ø§Ø¯ÙŠ","Ù‚Ù†Ø§","Ø³ohag","Ø£Ø³ÙŠÙˆØ·","Ø§Ù„ÙÙŠÙˆÙ…","Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ","Ø§Ù„Ø¬ÙŠØ²Ø©","Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©","Ø§Ù„Ø´Ø±Ù‚ÙŠØ©","Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©"
]; // 10 Ù…Ø­Ø·Ø§Øª Ù„Ø­Ø¯ 10,000 (ØªÙ‚Ø¯Ø± ØªØºÙŠÙ‘Ø± Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙƒÙ…Ø§ ØªØ­Ø¨)

const canvas = document.getElementById('game');
const c = canvas.getContext('2d');
const dpi = window.devicePixelRatio||1;
function fixDPI(){
  const cssW = canvas.clientWidth, cssH = canvas.clientHeight;
  canvas.width = Math.round(cssW * dpi);
  canvas.height = Math.round(cssH * dpi);
  c.setTransform(dpi,0,0,dpi,0,0);
}
fixDPI(); addEventListener('resize', fixDPI);

const W = ()=>canvas.clientWidth, H = ()=>canvas.clientHeight;
const GROUND_Y = ()=> H()*0.80;

let running=false, gameOver=false, won=false;
let score=0, best = parseInt(localStorage.getItem('flyrider_best2')||'0',10);
document.getElementById('best').textContent = best;

let worldSpeed = 6;               // Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù… (ØªØ²ÙˆØ¯ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§)
let baseEnemyEvery = 1800;        // Ø¨Ø§Ù„Ù…Ù„Ù‘ÙŠ Ø«Ø§Ù†ÙŠØ©
let lastEnemyAt = 0;
let bullets = [], enemies = [], signs = [];
let lastTime = 0;

/* ============ Ø³Ø§Ø¦Ù‚ Ø§Ù„Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„ (Ø±Ø³Ù… ÙÙŠÙƒØªÙˆØ±) ============ */
const rider = {
  x: 90, y: 0, w: 120, h: 70, vy: 0, onGround:true, tilt:0
};
rider.y = GROUND_Y() - rider.h;

function drawBikeRider(ts){
  const y = rider.y, x = rider.x;
  // Ø¸Ù„
  c.fillStyle='rgba(0,0,0,.13)';
  c.beginPath(); c.ellipse(x+rider.w*0.55, GROUND_Y()+6, 45, 9, 0, 0, Math.PI*2); c.fill();

  // Ù‡ÙŠÙƒÙ„ Ø¨Ø³ÙŠØ·
  c.save();
  if (!rider.onGround){
    rider.tilt = Math.sin(ts/120)*0.08;
    c.translate(x+rider.w/2, y+rider.h/2);
    c.rotate(rider.tilt);
    c.translate(-x-rider.w/2, -y-rider.h/2);
  }

  // Ø§Ù„Ø¥Ø·Ø§Ø±ÙŠÙ†
  function wheel(cx,cy){
    c.fillStyle='#101820'; c.beginPath(); c.arc(cx,cy,18,0,Math.PI*2); c.fill();
    c.fillStyle='#2c3e50'; c.beginPath(); c.arc(cx,cy,10,0,Math.PI*2); c.fill();
  }
  wheel(x+35, y+rider.h-6);
  wheel(x+rider.w-22, y+rider.h-6);

  // Ø¬Ø³Ù… Ø§Ù„Ø¯Ø±Ø§Ø¬Ø©
  c.strokeStyle='#0aa39a'; c.lineWidth=6;
  c.beginPath();
  c.moveTo(x+20, y+rider.h-20);
  c.lineTo(x+70, y+rider.h-40);
  c.lineTo(x+100, y+rider.h-22);
  c.stroke();

  // ÙƒØ±Ø³ÙŠ
  c.fillStyle='#2c3e50'; c.fillRect(x+58, y+rider.h-60, 30, 10);

  // Ø®Ø²Ø§Ù†
  c.fillStyle='#0aa39a';
  c.beginPath();
  c.ellipse(x+80, y+rider.h-56, 22, 12, 0, 0, Math.PI*2); c.fill();

  // Ø§Ù„Ø³Ø§Ø¦Ù‚
  c.fillStyle='#1f2d3a'; // Ø§Ù„Ø¬Ø³Ø¯
  c.fillRect(x+68, y+rider.h-80, 24, 26);
  c.fillStyle='#ffe1bd'; // Ø§Ù„Ø±Ø£Ø³
  c.beginPath(); c.arc(x+80, y+rider.h-92, 10, 0, Math.PI*2); c.fill();
  c.fillStyle='#1f2d3a'; // Ø®ÙˆØ°Ø©/Ø´Ø¹Ø±
  c.beginPath(); c.arc(x+80, y+rider.h-95, 12, Math.PI,0); c.fill();
  // ÙŠØ¯
  c.fillStyle='#ffe1bd'; c.fillRect(x+96, y+rider.h-64, 8, 8);

  c.restore();
}

/* ============ Ø®Ù„ÙÙŠØ© + Ø·Ø±ÙŠÙ‚ ============ */
const pebbles = Array.from({length:26}, (_,i)=>({x:i*60+Math.random()*40}));
function drawBackground(){
  const y = GROUND_Y();
  // Ø£Ø±Ø¶/Ø·Ø±ÙŠÙ‚
  c.strokeStyle = '#c6d0db'; c.lineWidth=2; c.beginPath(); c.moveTo(0,y); c.lineTo(W(),y); c.stroke();
  // Ø®Ø·ÙˆØ· Ø§Ù„Ø·Ø±ÙŠÙ‚
  c.fillStyle='#fff'; const seg=42, gap=70, off=-(Date.now()/20 % (seg+gap));
  for (let x=off; x<W(); x+=seg+gap){ c.fillRect(x, y-5, seg, 3); }

  // Ø­ØµÙ‰ ÙŠÙ…Ø´ÙŠ
  c.fillStyle='#a7b4c1';
  pebbles.forEach(p=>{ p.x -= worldSpeed*0.3; if (p.x<-10) p.x=W()+Math.random()*60; c.fillRect(p.x, y+8, 6, 2); });
}

/* ============ Ø¹ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ùˆ (Ø£Ø¹Ø¯Ø§Ø¡) + Ø±ØµØ§Øµ ============ */
function spawnEnemy(){
  const y = H()*0.25 + Math.random()*H()*0.25; // Ø§Ø±ØªÙØ§Ø¹ Ø³Ù…Ø§ÙˆÙŠ
  const speed = worldSpeed*(1.1 + Math.random()*0.6);
  enemies.push({
    x: W()+40, y, w: 36, h: 24, speed,
    shootCd: 500 + Math.random()*1200
  });
}
function drawEnemies(dt){
  c.fillStyle='#1b4e6b';
  enemies.forEach(e=>{
    // Ø¬Ø³Ù… Ø§Ù„Ø¹Ø¯Ùˆ (Ø¯Ø±ÙˆÙ†/Ø·Ø§Ø¦Ø± Ù…Ø¨Ø³Ù‘Ø·)
    c.fillStyle='#1b4e6b';
    c.fillRect(e.x, e.y, e.w, e.h);
    c.fillStyle='#5b8def'; c.fillRect(e.x+6, e.y+6, e.w-12, e.h-12);
    // Ø­Ø±ÙƒØ©
    e.x -= e.speed;
    e.shootCd -= dt;
    if (e.shootCd<=0){
      e.shootCd = 600 + Math.random()*1100;
      bullets.push({x:e.x+e.w/2-2, y:e.y+e.h, vy: 4+Math.random()*3, w:4, h:10});
    }
  });
  // Ø¥Ø²Ø§Ù„Ø©
  for(let i=enemies.length-1;i>=0;i--) if (enemies[i].x+enemies[i].w<-30) enemies.splice(i,1);
}
function drawBullets(){
  c.fillStyle='#e74c3c';
  bullets.forEach(b=>{
    b.y += b.vy;
    c.fillRect(b.x, b.y, b.w, b.h);
  });
  for(let i=bullets.length-1;i>=0;i--) if (bullets[i].y>GROUND_Y()) bullets.splice(i,1);
}

/* ============ ÙŠØ§ÙØ·Ø§Øª Ø§Ù„Ø¨Ù„Ø¯Ø§Ù† ============ */
let nextSignAt = SIGN_STEP;
let lastShownSign = -1;
let signFX = {show:false, name:'', alpha:0, x: W()*0.65};

function maybeShowSign(){
  if (score >= nextSignAt){
    const idx = Math.min(Math.floor(score/SIGN_STEP)-1, SIGN_NAMES.length-1);
    if (idx !== lastShownSign){
      lastShownSign = idx;
      signFX.show = true;
      signFX.name = SIGN_NAMES[idx] || ("Ø¨Ù„Ø¯ #" + (idx+1));
      signFX.alpha = 0;
      signFX.x = W()*0.72;
    }
    nextSignAt += SIGN_STEP;
  }
}
function drawSign(dt){
  if (!signFX.show) return;
  signFX.alpha += 0.02;
  signFX.x -= worldSpeed*0.8;
  if (signFX.alpha>1) signFX.alpha=1;
  c.save(); c.globalAlpha = signFX.alpha;
  // Ø¹Ù…ÙˆØ¯
  const y = GROUND_Y()-10;
  c.fillStyle='#8e9aaf'; c.fillRect(signFX.x-3, y-80, 6, 80);
  // Ø§Ù„Ù„ÙˆØ­Ø©
  c.fillStyle='#2ecc71'; c.fillRect(signFX.x-120, y-120, 240, 42);
  c.strokeStyle='#145a32'; c.strokeRect(signFX.x-120, y-120, 240, 42);
  c.fillStyle='#fff'; c.font='bold 18px Cairo, system-ui';
  c.textAlign='center'; c.fillText('Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ', signFX.x, y-100);
  c.fillText(signFX.name, signFX.x, y-80);
  c.restore();
  if (signFX.x < -260) signFX.show=false;
}

/* ============ ÙÙŠØ²ÙŠØ§Ø¡ + ØªØµØ§Ø¯Ù… ============ */
function physics(){
  // Ø¬Ø§Ø°Ø¨ÙŠØ©
  rider.vy += 0.7;
  rider.y  += rider.vy;
  if (rider.y + rider.h >= GROUND_Y()){
    rider.y = GROUND_Y() - rider.h; rider.vy=0; rider.onGround=true;
  }
  // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø±ØµØ§Øµ
  const rx=rider.x+15, ry=rider.y+10, rw=rider.w-30, rh=rider.h-14;
  for (const b of bullets){
    if (rx < b.x+b.w && rx+rw>b.x && ry < b.y+b.h && ry+rh>b.y){ endGame(false); break; }
  }
  // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø¹Ø¯Ùˆ Ù†ÙØ³Ù‡
  for (const e of enemies){
    if (rx < e.x+e.w && rx+rw>e.x && ry < e.y+e.h && ry+rh>e.y){ endGame(false); break; }
  }
}

/* ============ ØµÙˆØªÙŠØ§Øª ============ */
const bgm = document.getElementById('bgm');
const btnMusic = document.getElementById('btnMusic');
btnMusic.addEventListener('click', async ()=>{
  if (bgm.paused){ try{ await bgm.play(); btnMusic.textContent="Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª ğŸ”ˆ"; }catch{} }
  else { bgm.pause(); btnMusic.textContent="ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ğŸ”Š"; }
});
// SFX Ø¨Ø³ÙŠØ·Ø© Ø¨Ø§Ù„Ù€WebAudio
let AC, ctx, gain;
function audioInit(){ if (ctx) return; AC = window.AudioContext||window.webkitAudioContext; if(!AC) return; ctx = new AC(); gain=ctx.createGain(); gain.gain.value=0.15; gain.connect(ctx.destination); }
['click','touchstart','pointerdown','keydown'].forEach(ev=>addEventListener(ev,audioInit,{once:true}));
function beep(f=880,d=.08,type='square'){ if(!ctx) return; const o=ctx.createOscillator(), g=ctx.createGain(); o.type=type; o.frequency.value=f; o.connect(g); g.connect(gain); g.gain.setValueAtTime(.0001,ctx.currentTime); g.gain.exponentialRampToValueAtTime(.5,ctx.currentTime+.01); g.gain.exponentialRampToValueAtTime(.0001,ctx.currentTime+d); o.start(); o.stop(ctx.currentTime+d+.01); }
const sfx = { jump:()=>beep(900,.07,'square'), hit:()=>beep(160,.2,'sawtooth'), win:()=>{beep(660,.14,'sine'); setTimeout(()=>beep(990,.16,'sine'),130);} };

/* ============ ÙƒÙˆÙ†ÙÙŠØªÙŠ ============ */
function confettiBurst(x,y){
  const parts=Array.from({length:80},()=>({x,y,vx:(Math.random()-0.5)*7,vy:-Math.random()*6-2,life:70,c:`hsl(${Math.random()*360},90%,60%)`}));
  (function anim(){
    c.save(); c.globalAlpha=.9;
    parts.forEach(p=>{p.x+=p.vx; p.vy+=0.16; p.y+=p.vy; p.life--; c.fillStyle=p.c; c.fillRect(p.x,p.y,4,4);});
    c.restore();
    for(let i=parts.length-1;i>=0;i--) if(parts[i].life<=0) parts.splice(i,1);
    if(parts.length) requestAnimationFrame(anim);
  })();
}

/* ============ Ø§Ù„ØªØ­ÙƒÙ… ============ */
function jump(){
  if(!running) startGame();
  if(!rider.onGround || gameOver) return;
  rider.vy = -13; rider.onGround=false; sfx.jump(); if (navigator.vibrate) navigator.vibrate(12);
}
addEventListener('keydown',e=>{ if([' ','ArrowUp','w','W'].includes(e.key)){e.preventDefault(); jump();} if((e.key==='r'||e.key==='R')&&gameOver) resetGame(); });
canvas.addEventListener('pointerdown', jump);
document.getElementById('btnStart').addEventListener('click', jump);

/* ============ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© + Ù„ÙˆØ¨ ============ */
const overlay = document.getElementById('overlay');
const toast = document.getElementById('toast');

function startGame(){
  if (running) return;
  overlay.classList.add('hidden'); running=true; gameOver=false; won=false; lastTime=performance.now(); lastEnemyAt=performance.now();
  requestAnimationFrame(loop);
  if (bgm.paused) { bgm.play().catch(()=>{}); }
}
function endGame(isWin){
  running=false; gameOver=true; won=isWin;
  best = Math.max(best, score); localStorage.setItem('flyrider_best2', best);
  document.getElementById('best').textContent = best;

  if (isWin){
    showToast('ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙˆØµÙ„Øª Ù„Ø¢Ø®Ø± Ø¨Ù„Ø¯ â€” Ø®Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ© âœ…');
    sfx.win(); confettiBurst(W()/2, H()*0.28);
    if (navigator.vibrate) navigator.vibrate([15,40,15]);
  }else{
    showToast('ğŸ’¥ Ø£ÙˆÙˆØ¨Ø³! Ø£ØµØ§Ø¨Ùƒ Ø§Ù„Ø¹Ø¯Ùˆ â€” Ø§Ø¶ØºØ· Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©');
    sfx.hit(); if (navigator.vibrate) navigator.vibrate([50,60,50]);
  }
  setTimeout(()=>overlay.classList.remove('hidden'), 250);
}
function resetGame(){
  score=0; worldSpeed=6; nextSignAt=SIGN_STEP; lastShownSign=-1;
  bullets.length=0; enemies.length=0; signs.length=0;
  rider.y = GROUND_Y()-rider.h; rider.vy=0; rider.onGround=true;
  toast.classList.remove('show'); overlay.classList.add('hidden');
  running=true; gameOver=false; won=false; lastTime=performance.now(); lastEnemyAt=performance.now();
  requestAnimationFrame(loop);
}

overlay.addEventListener('pointerdown', ()=> gameOver ? resetGame() : startGame());

function showToast(msg){
  const el=document.getElementById('toast'); el.textContent=msg; el.classList.add('show');
}

function loop(ts){
  if(!running) return;
  const dtMs = ts - lastTime; const dt = dtMs/16.67; lastTime = ts;

  c.clearRect(0,0,W(),H());
  drawBackground();
  drawEnemies(dtMs);
  drawBullets();
  physics();
  drawBikeRider(ts);
  drawSign(dt);

  // Ù†Ù‚Ø§Ø·/Ø³Ø±Ø¹Ø©/Ø³Ø¨Ø§ÙˆÙ†
  score += Math.max(1, Math.floor(dt));
  if (score % 120 === 0) worldSpeed = Math.min(12, worldSpeed + 0.02);
  document.getElementById('score').textContent = score;

  if (ts - lastEnemyAt > baseEnemyEvery - worldSpeed*60){
    spawnEnemy(); lastEnemyAt = ts;
  }

  maybeShowSign();

  if (score >= GOAL && !won){ endGame(true); return; }
  requestAnimationFrame(loop);
}
</script>
</body>
</html>
